/**
 * CodeDropz Uploader v1.3.7.5
 * Copyright 2018 Glen Mongaya
 * CodeDrop Drag&Drop Uploader
 * @version 1.3.7.5
 * @author CodeDropz, Glen Don L. Mongaya
 * @license The MIT License (MIT)
 */
(function(){const CodeDropz_Uploader=function(settings){const form=document.querySelector('form.wpcf7-form');if(form){const data=new FormData();data.append('action','_wpcf7_check_nonce');data.append('_ajax_nonce',dnd_cf7_uploader.ajax_nonce);fetch(dnd_cf7_uploader.ajax_url,{method:'POST',body:data}).then(res=>res.json()).then(({data,success})=>success&&(dnd_cf7_uploader.ajax_nonce=data)).catch(console.error)}
var input=this;const defaultOptions={handler:input,color:'#000',background:'',server_max_error:'Uploaded file exceeds the maximum upload size of your server.',max_file:input.dataset.max?input.dataset.max:10,max_upload_size:input.dataset.limit?input.dataset.limit:'10485760',supported_type:input.dataset.type?input.dataset.type:'jpg|jpeg|JPG|png|gif|pdf|doc|docx|ppt|pptx|odt|avi|ogg|m4a|mov|mp3|mp4|mpg|wav|wmv|xls',text:'Drag & Drop Files Here',separator:'or',button_text:'Browse Files',on_success:'',};const options=Object.assign({},defaultOptions,settings);var dataStorageName=input.dataset.name+'_count_files';localStorage.setItem(dataStorageName,1);const cdropz_template=`
            <div class="codedropz-upload-handler">
                <div class="codedropz-upload-container">
                <div class="codedropz-upload-inner">
                    <${dnd_cf7_uploader.drag_n_drop_upload.tag}>${options.text}</${dnd_cf7_uploader.drag_n_drop_upload.tag}>
                    <span>${options.separator}</span>
                    <div class="codedropz-btn-wrap"><a class="cd-upload-btn" href="javascript:void(0)">${options.button_text}</a></div>
                </div>
                </div>
                <span class="dnd-upload-counter"><span>0</span> ${dnd_cf7_uploader.dnd_text_counter} ${parseInt(options.max_file)}</span>
            </div>
        `;const wrapper=document.createElement('div');wrapper.classList.add('codedropz-upload-wrapper');options.handler.parentNode.insertBefore(wrapper,options.handler);wrapper.appendChild(options.handler);options.supported_type=options.supported_type.replace(/[^a-zA-Z0-9| ]/g,"");const form_handler=options.handler.closest('form');const options_handler=options.handler.closest('.codedropz-upload-wrapper');const btnOBJ=form_handler.querySelector('input[type="submit"], button[type="submit"]');options.handler.insertAdjacentHTML('afterend',cdropz_template);['drag','dragstart','dragend','dragover','dragenter','dragleave','drop'].forEach(function(eventName){options_handler.querySelector('.codedropz-upload-handler').addEventListener(eventName,function(e){e.preventDefault();e.stopPropagation()})});['dragover','dragenter'].forEach(function(eventName){options_handler.querySelector('.codedropz-upload-handler').addEventListener(eventName,function(e){options_handler.querySelector('.codedropz-upload-handler').classList.add('codedropz-dragover')})});['dragleave','dragend','drop'].forEach(function(eventName){options_handler.querySelector('.codedropz-upload-handler').addEventListener(eventName,function(e){options_handler.querySelector('.codedropz-upload-handler').classList.remove('codedropz-dragover')})});options_handler.querySelector('.cd-upload-btn').addEventListener('click',function(e){e.preventDefault();options.handler.value=null;options.handler.click()});options_handler.querySelector('.codedropz-upload-handler').addEventListener('drop',function(event){DND_Setup_Uploader(event.dataTransfer.files,'drop')});options.handler.addEventListener('change',function(e){DND_Setup_Uploader(this.files,'click')});if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){input.removeAttribute('accept')}
var DND_Setup_Uploader=function(files,action){if(files.length==0)return;var formData=new FormData();formData.append('action','dnd_codedropz_upload');formData.append('type',action);formData.append('security',dnd_cf7_uploader.ajax_nonce);formData.append('form_id',input.dataset.id);formData.append('upload_name',input.dataset.name);const errorHandler=options.handler.querySelector('.has-error');if(errorHandler){errorHandler.remove()}
for(const file of files){if(typeof formData.delete!=='undefined'){formData.delete('upload-file')}
if(Number(localStorage.getItem(dataStorageName))>options.max_file){var hasErrorMsg=options_handler.querySelector('span.has-error-msg');if(!hasErrorMsg){var err_msg=dnd_cf7_uploader.drag_n_drop_upload.max_file_limit;var errorMsgEl=document.createElement('span');errorMsgEl.className='has-error-msg';errorMsgEl.textContent=err_msg.replace('%count%',options.max_file);options_handler.appendChild(errorMsgEl)}
return!1}
const progressBarID=CodeDropz_Object.createProgressBar(file);var has_error=!1;if(file.size>options.max_upload_size){const parentProgressBar=document.getElementById(progressBarID);const errorSpan=document.createElement('span');errorSpan.classList.add('has-error');errorSpan.textContent=dnd_cf7_uploader.drag_n_drop_upload.large_file;parentProgressBar.querySelector('.dnd-upload-details').appendChild(errorSpan);has_error=!0}
regex_type=new RegExp("(.*?)\.("+options.supported_type+")$");if(has_error===!1&&!(regex_type.test(file.name.toLowerCase()))){document.querySelector('#'+progressBarID+' .dnd-upload-details').insertAdjacentHTML('beforeend','<span class="has-error">'+dnd_cf7_uploader.drag_n_drop_upload.inavalid_type+'</span>');has_error=!0}
localStorage.setItem(dataStorageName,(Number(localStorage.getItem(dataStorageName))+1));if(has_error===!1){formData.append('upload-file',file);var xhr=new XMLHttpRequest();var progressBar=document.getElementById(progressBarID);var progressElement=progressBar.querySelector('.dnd-progress-bar');var detailsElement=progressBar.querySelector('.dnd-upload-details');var submitButton=form_handler.querySelector('input[type="submit"], button[type="submit"]');xhr.open(form_handler.getAttribute('method'),options.ajax_url);xhr.onreadystatechange=function(){if(this.readyState===4){if(this.status===200){var response=JSON.parse(this.responseText);if(response.success){CodeDropz_Object.setProgressBar(progressBarID,100);if(typeof options.on_success==="function"){options.on_success.call(this,input,progressBarID,response)}}else{progressElement.remove();detailsElement.insertAdjacentHTML('beforeend','<span class="has-error">'+response.data+'</span>');if(submitButton){submitButton.classList.remove('disabled');submitButton.removeAttribute('disabled')}
progressBar.classList.remove('in-progress')}}else{progressElement.remove();detailsElement.insertAdjacentHTML('beforeend','<span class="has-error">'+options.server_max_error+'</span>');if(submitButton){submitButton.classList.remove('disabled');submitButton.removeAttribute('disabled')}
progressBar.classList.remove('in-progress')}}};xhr.upload.addEventListener("progress",function(event){if(event.lengthComputable){var percentComplete=(event.loaded/event.total);var percentage=parseInt(percentComplete*100);CodeDropz_Object.setProgressBar(progressBarID,percentage-1)}},!1);xhr.send(formData)}}}
var CodeDropz_Object={createProgressBar:function(file){var upload_handler=options_handler.querySelector('.codedropz-upload-handler');var generated_ID='dnd-file-'+Math.random().toString(36).substr(2,9);var fileDetails=`
                    <div class="dnd-upload-image">
                        <span class="file"></span>
                    </div>
                    <div class="dnd-upload-details">
                        <span class="name"><span>${file.name}</span><em>(${CodeDropz_Object.bytesToSize(file.size)})</em></span>
                        <a href="javascript:void(0)" title="${dnd_cf7_uploader.drag_n_drop_upload.delete.title}" class="remove-file" data-storage="${dataStorageName}">
                        <span class="dnd-icon-remove"></span>
                        </a>
                        <span class="dnd-progress-bar"><span></span></span>
                    </div>
                `;var statusElement=document.createElement('div');statusElement.id=generated_ID;statusElement.className='dnd-upload-status';statusElement.innerHTML=fileDetails;upload_handler.parentNode.insertBefore(statusElement,upload_handler.nextSibling);return generated_ID},setProgressBar:function(progressBarID,percent){const progressBar=document.getElementById(progressBarID);const statusBar=progressBar.querySelector('.dnd-progress-bar');if(statusBar){if(btnOBJ){CodeDropz_Object.disableBtn(btnOBJ)}
let progress_width=percent*statusBar.offsetWidth/100;progressBar.classList.add('in-progress');if(percent==100){statusBar.querySelector('span').style.width='100%';statusBar.querySelector('span').textContent=`${percent}% `}else{statusBar.querySelector('span').style.width=progress_width+'px';statusBar.querySelector('span').textContent=`${percent}% `}
if(percent==100){progressBar.classList.add('complete');progressBar.classList.remove('in-progress')}}
return!1},bytesToSize:function(bytes){if(bytes===0)
return'0';kBytes=(bytes/1024);fileSize=(kBytes>=1024?(kBytes/1024).toFixed(2)+'MB':kBytes.toFixed(2)+'KB');return fileSize},disableBtn:function(BtnOJB){if(BtnOJB){BtnOJB.classList.add('disable');BtnOJB.disabled=!0}}}}
document.addEventListener("click",function(e){if(!e.target.classList.contains("dnd-icon-remove"))return;var _self=e.target,_dnd_status=_self.closest(".dnd-upload-status"),_parent_wrap=_self.closest(".codedropz-upload-wrapper"),removeStorageData=_self.parentElement.getAttribute("data-storage"),storageCount=Number(localStorage.getItem(removeStorageData));if(_dnd_status.classList.contains("in-progress")||_dnd_status.querySelector(".has-error")){_dnd_status.remove();localStorage.setItem(removeStorageData,storageCount-1);return!1}
_self.classList.add("deleting");_self.textContent=dnd_cf7_uploader.drag_n_drop_upload.delete.text+"...";var xhr=new XMLHttpRequest();xhr.open("POST",dnd_cf7_uploader.ajax_url);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(){if(this.status===200){var response=JSON.parse(this.responseText);if(response.success){_dnd_status.remove();localStorage.setItem(removeStorageData,storageCount-1);if(_parent_wrap.querySelectorAll(".dnd-upload-status").length<=1){if(_parent_wrap.querySelector(".has-error-msg")){_parent_wrap.querySelector(".has-error-msg").remove()}}
_parent_wrap.querySelector(".dnd-upload-counter span").textContent=Number(localStorage.getItem(removeStorageData))-1}}};xhr.send("path="+_dnd_status.querySelector('input[type="hidden"]').value+"&action=dnd_codedropz_upload_delete"+"&security="+dnd_cf7_uploader.ajax_nonce);document.querySelectorAll(".has-error-msg").forEach(function(el){el.remove()})});HTMLElement.prototype.CodeDropz_Uploader=CodeDropz_Uploader})();document.addEventListener('DOMContentLoaded',function(){document.addEventListener('wpcf7mailsent',function(event){const form=event.target;var inputFile=form.querySelectorAll('.wpcf7-drag-n-drop-file');var status=form.querySelectorAll('.dnd-upload-status');var counter=form.querySelector('.dnd-upload-counter span');var error=form.querySelectorAll('span.has-error-msg');if(inputFile.length>0){inputFile.forEach(function(input){localStorage.setItem(input.getAttribute('data-name')+'_count_files',1)})}
if(status){status.forEach(function(statEl){statEl.remove()})}
if(counter){counter.textContent='0'}
if(error){error.forEach(function(errEl){errEl.remove()})}},!1);window.initDragDrop=function(){var TextOJB=dnd_cf7_uploader.drag_n_drop_upload;var fileUpload=document.querySelectorAll('.wpcf7-drag-n-drop-file');fileUpload.forEach(function(Upload){Upload.CodeDropz_Uploader({'color':'#fff','ajax_url':dnd_cf7_uploader.ajax_url,'text':TextOJB.text,'separator':TextOJB.or_separator,'button_text':TextOJB.browse,'server_max_error':TextOJB.server_max_error,'on_success':function(input,progressBar,response){var progressDetails=document.querySelector('.codedropz-upload-wrapper #'+progressBar);var form=input.closest('form');var span=form.querySelector('.wpcf7-acceptance');var checkboxInput=(span?span.querySelector('input[type="checkbox"]'):'');const requiredMessage=input.closest('.codedropz-upload-wrapper').nextElementSibling;if(requiredMessage&&requiredMessage.classList.contains('wpcf7-not-valid-tip')){requiredMessage.remove()}
if((span&&span.classList.contains('optional'))||!span||checkboxInput.checked||form.classList.contains('wpcf7-acceptance-as-validation')){setTimeout(function(){const submitButton=form.querySelector('button[type=submit], input[type=submit]');if(submitButton){submitButton.removeAttribute('disabled')}},1)}
var detailsElement=progressDetails.querySelector('.dnd-upload-details');var inputHTML='<span><input type="hidden" name="'+input.dataset.name+'[]" value="'+response.data.path+'/'+response.data.file+'"></span>';detailsElement.insertAdjacentHTML('beforeend',inputHTML);var filesCounter=(Number(localStorage.getItem(input.dataset.name+'_count_files'))-1);var counterElement=input.closest('.codedropz-upload-wrapper').querySelector('.dnd-upload-counter span');counterElement.textContent=filesCounter}})})}
window.initDragDrop()})
;